<!-- extend base template -->
{% extends 'core/base.html' %}

<!-- title -->
{% block title %} Documents {% endblock %}

<!-- bread crumbs -->
{% block crumbs %} Library {% endblock %}

<!-- content for the body -->
{% block content %}

<!-- search bar -->
<div class="w-full mb-4 flex items-center justify-center mx-auto">
    <form action="{% url 'library:search-documents' %}" value="{{request.GET.q}}" method="get" class="w-full mx-auto text-lg shadow-md border-transparent rounded-lg">
        <input type="text" placeholder="Search documents" value="{{request.GET.q}}" name="search" class="w-full rounded-lg p-4 text-xl" >
        <!-- <input type="submit" value="Search" name="submit"> -->
    </form>
</div>

<div class="flex justify-between items-center mb-3">
    <!-- map document categories -->
    <div class="flex items-center space-x-6">
        {% for category in categories %}
            <form action="{% url 'library:search-documents' %}" method="get" value="{{category.name}}" class="bg-white rounded-lg p-2 shadow-md flex gap-2 cursor-pointer">
                <input type="submit" name="search" value="{{category.name}}" {{ category.name}} />
                <h3 class="text-blue-600">{{category.documents.count}}</h3>
            </form> 
        {% endfor %}
    </div> 
</div>


<!-- <div class="mt-6"> -->
     {% if searchRequest %}
       {% if documents %}
            <h3>Results for {{query}}</h3>
        {% else %}
            <h3 class="text-2xl font-semibold">Did not find any documents for <span class="text-blue-600">{{query}}</span></h3>
       {% endif %}
     {% endif %}
  
    {% if documents %}
    <div class="">
        <!-- loop documents -->
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Id</th>
                        <th>Borrowed</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Name</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Category</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Issued_to</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Date Created</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Created by</th>
                        <th scope="col" class="px-6 py-3.5 text-md font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">Document Actions</th>
                    </tr>
                </thead>

                <tbody class="bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-900 shadow-md rounded-sm">
                    {% for document in documents %}
                      <tr>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap">{{ document.id }}</td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap"> 
                            <a href="{% url 'library:return-document' document.id %}">
                            <form action="" method="post">
                                {% csrf_token %}
                               <input type="checkbox" name="borrowed" value="{{request.GET.borrowed}}" {% if document.borrowed %} checked {% endif %}> 
                            </form>
                            </a>
                            {{checked}}
                        </td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap capitalize">{{ document.name }}</td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap capitalize">{{ document.categories.name }}</td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap">{{ document.issued_to }}</td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap">{{ document.created_at }}</td>
                        <td class="px-6 py-3.5 text-lg font-medium text-left rtl:text-right whitespace-nowrap capitalize">{{ document.created_by.username }}</td>
                        <td>
                            <div class="flex space-x-4 justify-center">
                                <a href="{% url 'library:document' document.id %}">Details</a>
                                {% if document.created_by.username == request.authenticated.user %}
                                <a href="{% url 'library:update-document' document.id %}">Edit</a>
                                {% endif %}
                                {% if document.created_by.username == request.authenticated.user %}
                                <a href="{% url 'library:delete-document' document.id %}">Delete</a>
                                {% endif %}
                                <!-- only show the lend action when document.borrowed is false -->
                                {% if document.borrowed == False %}
                                <a href="{% url 'library:issue-document' document.id %}">Lend</a>
                                {% endif %}
                            </div>
                        </td>
                      </tr>
                    {% endfor %}
                </tbody>
            </table>
    </div>
    {% else %}
    <div class="mt-3">
        <h3 class="text-2xl font-semibold ">No documents available</h3>
    </div>
    {% endif %}

{% endblock %}
